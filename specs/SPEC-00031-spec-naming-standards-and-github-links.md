# SPEC-00031: Spec Naming Standards and GitHub Link Improvements

**Status:** Draft
**Created:** 2025-11-12
**Author:** Claude Code
**Plugin:** fractary-spec
**Type:** Enhancement

## Overview

This specification establishes standardized naming conventions for specification files generated by the fractary-spec plugin and fixes GitHub link generation to enable clickable references in issue comments.

## Problem Statement

### Issue 1: Inconsistent Naming Convention

The `fractary-spec:generate` command currently produces spec filenames that don't match the repository's established standards:

**Current Behavior:**
- Generates: `spec-84-feature-name.md` (lowercase, variable digits)
- Uses issue number directly as spec number

**Repository Standard:**
- Uses: `SPEC-00001-feature-name.md` (uppercase, 4-digit zero-padded)
- Examples in `/docs/specs/`:
  - `SPEC-00001-faber-plugin-implementation-plan.md`
  - `SPEC-00029-08-spec-plugin-architecture.md`
  - `SPEC-00030-01-codex-knowledge-retrieval-architecture.md`

**Mismatch:**
- Case: lowercase `spec` vs uppercase `SPEC`
- Padding: Variable digits (`84`) vs zero-padded 4 digits (`0084`)
- Namespace collision risk: Issue #123 creates `spec-123-*.md`, but standalone SPEC-00123 also exists

### Issue 2: Non-Clickable GitHub Links

When a spec is created, the plugin comments on the GitHub issue with a reference to the spec file:

**Current Comment:**
```markdown
ðŸ“‹ Specification Created

Specification generated for this issue:
- [spec-123-feature.md](/specs/spec-123-feature.md)

This spec will guide implementation and be validated before archival.
```

**Problem:**
The markdown link uses a relative path (`/specs/spec-123-feature.md`) which is **not clickable** in the GitHub web interface because:
1. It's a relative path without a repository context
2. GitHub needs a full URL to the file in a specific branch

**Desired Behavior (Dual-Link Approach):**
```markdown
ðŸ“‹ Specification Created

Specification generated for this issue:
- **Preview:** [WORK-00123-feature.md](https://github.com/owner/repo/blob/feature-branch/specs/WORK-00123-feature.md) (current branch)
- **Permanent:** [WORK-00123-feature.md](https://github.com/owner/repo/blob/main/specs/WORK-00123-feature.md) (after merge)

This spec will guide implementation and be validated before archival.
```

**Why Dual Links?**
- **Preview link**: Points to current branch, works immediately, allows reviewer to see spec right now
- **Permanent link**: Points to default branch (main/master), works after PR merge, permanent reference

This approach ensures the comment is useful both during development (preview) and after merge (permanent), avoiding broken links in either scenario.

## Requirements

### FR1: Establish Naming Convention Standards

Define clear, enforceable naming standards for all spec types:

1. **Issue-Associated Specs** (generated from GitHub issues)
   - Format: `WORK-XXXXX-slug.md`
   - XXXXX = 5-digit zero-padded issue number
   - Prefix: `WORK` (distinguishes from standalone specs)
   - Examples:
     - Issue #84 â†’ `WORK-00084-implement-feature.md`
     - Issue #1234 â†’ `WORK-01234-fix-bug.md`

2. **Standalone Specs** (not tied to issues)
   - Format: `SPEC-XXXX-slug.md`
   - XXXX = 4-digit zero-padded sequential number
   - Increments from highest existing SPEC number
   - Examples:
     - Next available: `SPEC-00031-architecture-design.md`
     - Following: `SPEC-00032-data-model.md`

3. **Multi-Spec for Single Issue** (large issues split into phases)
   - Format: `WORK-XXXXX-YY-slug.md` or `WORK-XXXXX-A-slug.md`
   - YY = 2-digit phase number (01, 02, 03...)
   - A = Letter suffix (A, B, C...)
   - Examples (numeric):
     - Issue #123, Phase 1: `WORK-00123-01-authentication.md`
     - Issue #123, Phase 2: `WORK-00123-02-oauth-integration.md`
   - Examples (letter):
     - Issue #123, Phase A: `WORK-00123-A-authentication.md`
     - Issue #123, Phase B: `WORK-00123-B-oauth-integration.md`

**Decision: Use Numeric Suffix** (`.01`, `.02`) for phases to support >26 phases if needed.

### FR2: Fix GitHub Link Generation

Update the GitHub comment to include dual clickable links (preview + permanent):

**Changes Required:**
1. Detect repository owner and name from git remote
2. Detect current branch name
3. Detect default branch name (main/master/etc.)
4. Construct two full GitHub URLs:
   - Preview: `https://github.com/{owner}/{repo}/blob/{current-branch}/{path}`
   - Permanent: `https://github.com/{owner}/{repo}/blob/{default-branch}/{path}`
5. Use both URLs in markdown with clear labels

**Implementation Location:**
- File: `plugins/spec/skills/spec-generator/scripts/link-to-issue.sh`
- Lines: 22, 29 (markdown link generation)

### FR3: Update Configuration Schema

Add naming configuration to support the standards:

```json
{
  "naming": {
    "issue_specs": {
      "prefix": "WORK",
      "digits": 5,
      "phase_format": "numeric",  // "numeric" | "letter"
      "phase_separator": "-"      // "-" for WORK-00123-01
    },
    "standalone_specs": {
      "prefix": "SPEC",
      "digits": 4,
      "auto_increment": true
    }
  }
}
```

### FR4: Update Documentation

Update all references to spec naming:
- `plugins/spec/README.md` - Examples
- `plugins/spec/commands/generate.md` - Usage examples
- `plugins/spec/skills/spec-generator/SKILL.md` - Naming rules
- `plugins/spec/skills/spec-generator/workflow/generate-from-issue.md` - Step 6 (filename generation)
- `docs/guides/fractary-spec-guide.md` - User-facing docs

## Design

### Naming Algorithm

**For Issue-Associated Specs:**

```bash
# Input: issue_number, phase (optional), title
issue_number=123
phase=1  # optional
title="Implement User Authentication"

# Generate slug
slug=$(echo "$title" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9 ]//g' | tr -s ' ' | tr ' ' '-' | cut -d'-' -f1-5)
# Result: "implement-user-authentication"

# Format issue number with leading zeros (5 digits)
padded_issue=$(printf "%05d" "$issue_number")
# Result: "00123"

# Build filename
if [ -n "$phase" ]; then
  # With phase
  padded_phase=$(printf "%02d" "$phase")
  filename="WORK-${padded_issue}-${padded_phase}-${slug}.md"
  # Result: "WORK-00123-01-implement-user-authentication.md"
else
  # Without phase
  filename="WORK-${padded_issue}-${slug}.md"
  # Result: "WORK-00123-implement-user-authentication.md"
fi
```

**For Standalone Specs:**

```bash
# Find highest SPEC number
highest=$(ls specs/SPEC-*.md 2>/dev/null |
          sed 's/.*SPEC-//' |
          sed 's/-.*//' |
          sed 's/[A-Z]$//' |  # Remove letter suffixes
          sort -n |
          tail -1)

# Increment
next_spec=$((highest + 1))

# Pad to 4 digits
padded_spec=$(printf "%04d" "$next_spec")

# Build filename
filename="SPEC-${padded_spec}-${slug}.md"
# Result: "SPEC-00032-architecture-design.md"
```

### GitHub URL Construction

**In `link-to-issue.sh`:**

```bash
#!/usr/bin/env bash
#
# link-to-issue.sh - Link spec to GitHub issue via comment
#
# Usage: link-to-issue.sh <issue_number> <spec_path> [phase]

set -euo pipefail

ISSUE_NUMBER="${1:?Issue number required}"
SPEC_PATH="${2:?Spec path required}"
PHASE="${3:-}"

SPEC_FILENAME=$(basename "$SPEC_PATH")

# Get repository info from git
REMOTE_URL=$(git config --get remote.origin.url)

# Parse GitHub owner/repo from remote URL
# Handles both HTTPS and SSH formats:
# - https://github.com/owner/repo.git
# - git@github.com:owner/repo.git
if [[ "$REMOTE_URL" =~ github\.com[:/]([^/]+)/([^/.]+) ]]; then
  REPO_OWNER="${BASH_REMATCH[1]}"
  REPO_NAME="${BASH_REMATCH[2]}"
else
  echo "Warning: Could not parse GitHub repository from remote URL" >&2
  # Fallback: single relative path link
  PREVIEW_URL="$SPEC_PATH"
  PERMANENT_URL="$SPEC_PATH"
fi

# Get current branch
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

# Get default branch from remote
DEFAULT_BRANCH=$(git remote show origin | grep 'HEAD branch' | cut -d' ' -f5)
if [[ -z "$DEFAULT_BRANCH" ]]; then
  # Fallback to common defaults
  if git show-ref --verify --quiet refs/remotes/origin/main; then
    DEFAULT_BRANCH="main"
  elif git show-ref --verify --quiet refs/remotes/origin/master; then
    DEFAULT_BRANCH="master"
  else
    DEFAULT_BRANCH="main"  # Final fallback
  fi
fi

# Construct full GitHub URLs (dual-link approach)
if [[ -n "${REPO_OWNER:-}" && -n "${REPO_NAME:-}" ]]; then
  # Remove leading slash from spec path if present
  CLEAN_PATH="${SPEC_PATH#/}"

  # Preview link: current branch
  PREVIEW_URL="https://github.com/${REPO_OWNER}/${REPO_NAME}/blob/${CURRENT_BRANCH}/${CLEAN_PATH}"

  # Permanent link: default branch
  PERMANENT_URL="https://github.com/${REPO_OWNER}/${REPO_NAME}/blob/${DEFAULT_BRANCH}/${CLEAN_PATH}"
fi

# Build comment message with dual links
if [[ -n "$PHASE" ]]; then
    COMMENT_BODY="ðŸ“‹ Specification Created (Phase $PHASE)

Specification generated for this issue:
- **Preview:** [$SPEC_FILENAME]($PREVIEW_URL) (current branch: \`$CURRENT_BRANCH\`)
- **Permanent:** [$SPEC_FILENAME]($PERMANENT_URL) (after merge to \`$DEFAULT_BRANCH\`)

This spec will guide implementation and be validated before archival."
else
    COMMENT_BODY="ðŸ“‹ Specification Created

Specification generated for this issue:
- **Preview:** [$SPEC_FILENAME]($PREVIEW_URL) (current branch: \`$CURRENT_BRANCH\`)
- **Permanent:** [$SPEC_FILENAME]($PERMANENT_URL) (after merge to \`$DEFAULT_BRANCH\`)

This spec will guide implementation and be validated before archival."
fi

# Comment on issue
gh issue comment "$ISSUE_NUMBER" --body "$COMMENT_BODY" 2>/dev/null || {
    echo "Warning: Failed to comment on issue #$ISSUE_NUMBER" >&2
    exit 0  # Non-critical, don't fail
}

echo "GitHub comment added to issue #$ISSUE_NUMBER"
```

### Configuration Updates

**New `config.example.json`:**

```json
{
  "storage": {
    "local_path": "/specs",
    "cloud_archive_path": "archive/specs/{year}/{spec_id}.md"
  },
  "naming": {
    "issue_specs": {
      "prefix": "WORK",
      "digits": 5,
      "phase_format": "numeric",
      "phase_separator": "-"
    },
    "standalone_specs": {
      "prefix": "SPEC",
      "digits": 4,
      "auto_increment": true,
      "start_from": null
    }
  },
  "archive": {
    "auto_archive_on": {
      "issue_close": true,
      "pr_merge": true,
      "faber_release": true
    },
    "pre_archive": {
      "check_docs_updated": "warn",
      "prompt_user": true
    }
  },
  "integration": {
    "update_issue_on_create": true,
    "github_link_format": "dual"
  }
}
```

## Implementation Plan

### Phase 1: Update Naming Logic

**Files to Modify:**
1. `plugins/spec/skills/spec-generator/workflow/generate-from-issue.md`
   - Update Step 6: Generate Filename
   - Add WORK prefix logic
   - Add 5-digit padding for issue numbers
   - Add phase numbering (01, 02, etc.)

2. `plugins/spec/config/config.example.json`
   - Add `naming` configuration section
   - Add `integration.github_url_format` setting

3. `plugins/spec/skills/spec-generator/SKILL.md`
   - Update CRITICAL_RULES line 13 to reference new naming convention

**Script Changes:**
No changes needed to `generate-spec.sh` - it receives the filename as a parameter.

### Phase 2: Update GitHub Link Generation

**Files to Modify:**
1. `plugins/spec/skills/spec-generator/scripts/link-to-issue.sh`
   - Add repository detection logic
   - Add branch detection logic
   - Construct full GitHub URLs
   - Fallback to relative paths if detection fails

**Testing:**
- Test with HTTPS remote URLs
- Test with SSH remote URLs
- Test fallback behavior
- Verify clickable links in GitHub web UI

### Phase 3: Update Documentation

**Files to Update:**
1. `plugins/spec/README.md`
   - Update Quick Start examples (line 54)
   - Update Multi-Spec examples (lines 130-138)
   - Update command output examples (line 100)

2. `plugins/spec/commands/generate.md`
   - Update Usage examples (line 34)
   - Update Multi-Spec examples (lines 39-45)
   - Update Output example (line 100)

3. `plugins/spec/skills/spec-generator/workflow/generate-from-issue.md`
   - Update Step 6 examples (lines 100-103)
   - Update filename patterns (lines 82-88)

4. `docs/guides/fractary-spec-guide.md`
   - Update all examples to use WORK prefix
   - Update naming convention documentation

### Phase 4: Migration Guide (Optional)

Create a migration script for existing specs:

**`scripts/migrate-spec-names.sh`:**
```bash
#!/usr/bin/env bash
# Migrate existing spec-NNN-*.md files to WORK-NNNNN-*.md format

for file in specs/spec-*.md; do
  if [[ -f "$file" ]]; then
    # Extract issue number
    issue=$(basename "$file" | sed 's/spec-//' | sed 's/-.*//')

    # Pad to 5 digits
    padded=$(printf "%05d" "$issue")

    # Get rest of filename
    rest=$(basename "$file" | sed 's/spec-[0-9]*-//')

    # New filename
    new_name="WORK-${padded}-${rest}"

    echo "Rename: $file -> specs/$new_name"
    # Uncomment to execute:
    # git mv "$file" "specs/$new_name"
  fi
done
```

**Note:** This is optional and should only be run if there are active issue-based specs in the repository.

## Acceptance Criteria

- [ ] **AC1:** Specs generated from issues use `WORK-XXXXX-slug.md` format with 5-digit padding
- [ ] **AC2:** Multi-phase specs use `WORK-XXXXX-YY-slug.md` format with 2-digit phase numbers
- [ ] **AC3:** Standalone specs continue using `SPEC-XXXX-slug.md` with 4-digit padding
- [ ] **AC4:** GitHub comments contain dual clickable links (preview + permanent)
- [ ] **AC5:** Preview link points to current branch and works immediately
- [ ] **AC6:** Permanent link points to default branch (main/master) and works after merge
- [ ] **AC7:** Both links work in GitHub web interface and navigate to correct file
- [ ] **AC8:** Configuration file includes `naming` section with all parameters
- [ ] **AC9:** All documentation updated with new naming examples and dual-link format
- [ ] **AC10:** Existing functionality preserved (no breaking changes to skill invocation)
- [ ] **AC11:** Fallback behavior works if GitHub URL construction fails (uses relative paths)
- [ ] **AC12:** FABER integration continues to work with new naming

## Testing Strategy

### Unit Tests

**Naming Logic:**
```bash
# Test issue spec naming
assert_equal "$(generate_work_spec_name 84 "" "implement feature")" "WORK-00084-implement-feature.md"
assert_equal "$(generate_work_spec_name 1234 "" "fix bug")" "WORK-01234-fix-bug.md"

# Test phase naming
assert_equal "$(generate_work_spec_name 123 1 "auth")" "WORK-00123-01-auth.md"
assert_equal "$(generate_work_spec_name 123 12 "oauth")" "WORK-00123-12-oauth.md"

# Test standalone spec naming
assert_equal "$(generate_standalone_spec_name "architecture")" "SPEC-00031-architecture.md"
```

**URL Construction:**
```bash
# Test HTTPS URL parsing (dual-link)
test_url_https_dual() {
  REMOTE_URL="https://github.com/fractary/claude-plugins.git"
  CURRENT_BRANCH="feature/my-feature"
  DEFAULT_BRANCH="main"
  PATH="specs/WORK-00123-feature.md"

  preview=$(construct_github_url "$REMOTE_URL" "$CURRENT_BRANCH" "$PATH")
  permanent=$(construct_github_url "$REMOTE_URL" "$DEFAULT_BRANCH" "$PATH")

  expected_preview="https://github.com/fractary/claude-plugins/blob/feature/my-feature/specs/WORK-00123-feature.md"
  expected_permanent="https://github.com/fractary/claude-plugins/blob/main/specs/WORK-00123-feature.md"

  assert_equal "$preview" "$expected_preview"
  assert_equal "$permanent" "$expected_permanent"
}

# Test SSH URL parsing (dual-link)
test_url_ssh_dual() {
  REMOTE_URL="git@github.com:fractary/claude-plugins.git"
  CURRENT_BRANCH="feature/test"
  DEFAULT_BRANCH="main"
  PATH="specs/WORK-00123-feature.md"

  preview=$(construct_github_url "$REMOTE_URL" "$CURRENT_BRANCH" "$PATH")
  permanent=$(construct_github_url "$REMOTE_URL" "$DEFAULT_BRANCH" "$PATH")

  expected_preview="https://github.com/fractary/claude-plugins/blob/feature/test/specs/WORK-00123-feature.md"
  expected_permanent="https://github.com/fractary/claude-plugins/blob/main/specs/WORK-00123-feature.md"

  assert_equal "$preview" "$expected_preview"
  assert_equal "$permanent" "$expected_permanent"
}

# Test default branch detection
test_default_branch_detection() {
  # Test main
  assert_equal "$(detect_default_branch)" "main"

  # Test master fallback
  assert_equal "$(detect_default_branch)" "master"
}
```

### Integration Tests

1. **Generate spec from issue:**
   ```bash
   /fractary-spec:generate 84
   # Verify: specs/WORK-00084-*.md created
   # Verify: GitHub comment has dual links (preview + permanent)
   # Verify: Preview link works immediately
   # Verify: Permanent link shows 404 before merge (expected)
   ```

2. **Generate multi-phase spec:**
   ```bash
   /fractary-spec:generate 123 --phase 1 --title "Authentication"
   /fractary-spec:generate 123 --phase 2 --title "OAuth"
   # Verify: WORK-00123-01-authentication.md
   # Verify: WORK-00123-02-oauth.md
   # Verify: Both have dual links in comments
   ```

3. **Test GitHub link clickability:**
   - Generate spec from issue
   - View issue in GitHub web UI
   - Click **preview link** in comment
   - Verify file opens in browser on current branch
   - Merge PR to main
   - Click **permanent link** in comment
   - Verify file opens in browser on main branch

4. **Test dual-link lifecycle:**
   - Before merge: Preview link works, permanent link 404
   - After merge: Both links work and point to same content
   - After branch deletion: Preview link 404, permanent link works

### Manual Testing

- [ ] Test in repository with HTTPS remote
- [ ] Test in repository with SSH remote
- [ ] Test with branch names containing special characters
- [ ] Test default branch detection (main vs master)
- [ ] Test fallback when git remote not available
- [ ] Test dual links remain stable after branch rename
- [ ] Test FABER workflow integration with new naming and links

## Migration Impact

### Breaking Changes

**Filename Format Change:**
- Old: `spec-123-feature.md`
- New: `WORK-00123-feature.md`

**Impact:**
- Existing specs in `/specs` directory won't match new format
- Archive index references won't match new format
- Any hardcoded references in documentation

**Mitigation:**
1. Migration is opt-in (old specs continue to work)
2. Only new specs use new format
3. Archive system handles both formats
4. Optional migration script provided

### Non-Breaking Changes

**Configuration:**
- New `naming` section is additive
- Defaults maintain backward compatibility
- Existing configs continue to work

**GitHub Comments:**
- URL format change is backward compatible
- Old relative links still present, just not clickable
- New full URLs are clickable

## Alternatives Considered

### Alternative 1: Keep Issue Number, Add Prefix

**Format:** `SPEC-ISSUE-00123-feature.md`

**Pros:**
- Keeps SPEC prefix
- Clearly identifies as issue-based

**Cons:**
- Verbose filename
- Redundant information ("ISSUE" is obvious from 5 digits)

**Decision:** Rejected - too verbose

### Alternative 2: Use Issue Number as Spec Number with Offset

**Format:** `SPEC-10084-feature.md` (issue 84 + 10000 offset)

**Pros:**
- Maintains SPEC prefix
- Numeric sequence
- Clear separation (issues <10000, offset >=10000)

**Cons:**
- Confusing offset calculation
- Breaks down if issues >10000
- Not intuitive

**Decision:** Rejected - too confusing

### Alternative 3: Separate Directory for Issue Specs

**Format:** `specs/issues/SPEC-00084-feature.md`

**Pros:**
- Clear separation
- No naming conflicts
- Maintains SPEC prefix

**Cons:**
- Changes storage structure
- Affects archival paths
- Complicates lookups

**Decision:** Rejected - structural change too invasive

### Selected: WORK Prefix with 5 Digits

**Format:** `WORK-00084-feature.md`

**Pros:**
- Clear semantic distinction (WORK = issue-based)
- No namespace conflicts
- 5 digits support issues up to 99,999
- Clean and intuitive
- Aligns with "work item" terminology from fractary-work plugin

**Cons:**
- Different from SPEC prefix (mitigated: this is the point)
- Requires migration for existing specs (mitigated: opt-in)

## References

- **fractary-spec Plugin:** `plugins/spec/`
- **Existing Specs:** `specs/SPEC-*.md`
- **Plugin Standards:** `docs/standards/FRACTARY-PLUGIN-STANDARDS.md`
- **GitHub Markdown:** [Creating and highlighting code blocks](https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/creating-and-highlighting-code-blocks)

## Future Enhancements

### FE1: Spec Registry

Maintain a central registry of all specs (issue-based and standalone):

```json
{
  "specs": [
    {
      "id": "WORK-00084",
      "type": "work",
      "issue": 84,
      "path": "specs/WORK-00084-feature.md",
      "status": "active"
    },
    {
      "id": "SPEC-00031",
      "type": "standalone",
      "path": "specs/SPEC-00031-naming-standards.md",
      "status": "active"
    }
  ]
}
```

### FE2: Auto-Link Detection

Automatically detect and link related specs in issue/PR descriptions:
- Scan for `WORK-XXXXX` or `SPEC-XXXX` references
- Create hyperlinks automatically
- Update when specs archived

### FE3: Spec Dashboard

GitHub Actions workflow to generate spec dashboard:
- Active specs
- Archived specs
- Validation status
- Coverage metrics

## Appendix: Example Conversions

### Issue-Based Specs

| Issue # | Old Name | New Name |
|---------|----------|----------|
| 84 | `spec-84-feature.md` | `WORK-00084-feature.md` |
| 123 | `spec-123-bug-fix.md` | `WORK-00123-bug-fix.md` |
| 1234 | `spec-1234-enhancement.md` | `WORK-01234-enhancement.md` |

### Multi-Phase Specs

| Issue # | Phase | Old Name | New Name |
|---------|-------|----------|----------|
| 123 | 1 | `spec-123-phase1-auth.md` | `WORK-00123-01-auth.md` |
| 123 | 2 | `spec-123-phase2-oauth.md` | `WORK-00123-02-oauth.md` |
| 456 | 1 | `spec-456-phase1-setup.md` | `WORK-00456-01-setup.md` |

### Standalone Specs (No Change)

| Current | Remains |
|---------|---------|
| `SPEC-00001-faber.md` | `SPEC-00001-faber.md` |
| `SPEC-00031-naming.md` | `SPEC-00031-naming.md` |

---

**End of Specification**
