---
spec_id: adoption-{{project_name}}-{{date}}
project: {{project_name}}
type: faber-cloud-adoption
status: draft
created: {{date}}
complexity: {{complexity}}
estimated_hours: {{estimated_hours}}
---

# Faber-Cloud Adoption Plan: {{project_name}}

**Project**: {{project_name}}
**Generated**: {{date}}
**Complexity**: {{complexity}}
**Estimated Time**: {{estimated_hours}} hours

---

## Executive Summary

This document provides a detailed, step-by-step migration plan to adopt faber-cloud infrastructure lifecycle management for the {{project_name}} project.

**Current State**: {{current_deployment_method}}
**Target State**: Standardized faber-cloud deployment with project-specific hooks and documentation
**Migration Approach**: {{migration_approach}}

### Key Metrics

| Metric | Value |
|--------|-------|
| **Infrastructure Structure** | {{terraform_structure}} |
| **Terraform Resources** | {{resource_count}} |
| **Environments** | {{environment_count}} ({{environments}}) |
| **Custom Scripts to Migrate** | {{custom_scripts_count}} |
| **Commands to Convert** | {{commands_count}} |
| **Estimated Migration Time** | {{estimated_hours}} hours |
| **Complexity Level** | {{complexity}} |

---

## Phase 1: Project Documentation ({{phase1_hours}} hours)

Create structured documentation that faber-cloud will reference during deployments.

### Task 1.1: Create Architecture Documentation

**Create File**: `docs/infrastructure/ARCHITECTURE.md`

```markdown
{{architecture_content}}
```

**Why**: This documents your infrastructure design decisions, components, and architecture. Faber-cloud commands will read this to understand your infrastructure context.

**How to populate**:
1. Review your Terraform files in `{{terraform_directory}}`
2. Document each major component ({{discovered_components}})
3. Explain architecture decisions
4. Include environment differences

---

### Task 1.2: Create Deployment Standards

**Create File**: `docs/infrastructure/DEPLOYMENT-STANDARDS.md`

```markdown
{{deployment_standards_content}}
```

**Why**: This documents your deployment requirements, naming conventions, and validation rules. Faber-cloud will ensure these standards are followed.

**Extracted Standards**:
{{extracted_standards}}

---

### Task 1.3: Create Naming Conventions

**Create File**: `docs/infrastructure/NAMING-CONVENTIONS.md`

```markdown
{{naming_conventions_content}}
```

**Discovered Pattern**: `{{discovered_naming_pattern}}`

**Examples from your infrastructure**:
{{naming_examples}}

---

### Task 1.4: Create Security Requirements

**Create File**: `docs/infrastructure/SECURITY-REQUIREMENTS.md`

```markdown
{{security_requirements_content}}
```

**Discovered Security Configurations**:
{{discovered_security}}

---

## Phase 2: Convert Custom Commands ({{phase2_hours}} hours)

Convert your custom infrastructure commands to delegate to faber-cloud.

{{#commands}}
### Task 2.{{task_number}}: Convert `{{command_name}}` Command

**Current File**: `{{current_path}}`
**Current Approach**: {{current_approach}}
**Current Lines of Code**: {{current_loc}}

**Replace with**:

**File**: `{{current_path}}`

```markdown
{{new_command_content}}
```

**What Changed**:
- ❌ **Removed**: {{removed_lines}} lines of custom deployment logic
- ✅ **Added**: Delegation to faber-cloud infra-manager
- ✅ **Preserved**: Project-specific context via documentation
- ✅ **Benefit**: {{benefit}}

**Testing**:
```bash
# Test the converted command
{{test_command}}

# Expected: Delegates to faber-cloud with project context
```

---
{{/commands}}

## Phase 3: Create Skill Hooks ({{phase3_hours}} hours)

Convert your validation scripts to skill hooks that integrate with faber-cloud lifecycle.

{{#validation_scripts}}
### Task 3.{{task_number}}: Convert `{{script_name}}` to Skill Hook

**Current Script**: `{{script_path}}`
**Purpose**: {{script_purpose}}
**Current Usage**: {{current_usage}}
**Lifecycle Hook Point**: {{hook_point}}

**Create Skill**:

**File**: `.claude/skills/{{skill_name}}/SKILL.md`

```markdown
{{skill_content}}
```

**What This Does**:
1. Receives WorkflowContext from faber-cloud (environment, operation)
2. {{skill_workflow_step1}}
3. {{skill_workflow_step2}}
4. {{skill_workflow_step3}}
5. Returns WorkflowResult (success/failure) to faber-cloud

**Migrated Logic**:
```bash
{{migrated_script_logic}}
```

**Testing**:
```bash
# Test skill independently
export FABER_CLOUD_ENV="test"
export FABER_CLOUD_OPERATION="deploy"
/skill {{skill_name}}

# Expected output:
# ✅ {{expected_success_message}}
# OR
# ❌ {{expected_failure_message}}
```

---
{{/validation_scripts}}

{{#has_no_validation_scripts}}
### No Custom Validation Scripts Found

Your project doesn't have custom validation scripts. You can skip Phase 3 or add skill hooks later as needed.

**Common Hooks to Consider**:
- Pre-deploy data validation
- Post-deploy health checks
- Pre-destroy backups
- Post-deploy smoke tests

---
{{/has_no_validation_scripts}}

## Phase 4: Configure Faber-Cloud ({{phase4_hours}} hours)

Create the faber-cloud configuration with all environments, hooks, and settings.

### Task 4.1: Create Faber-Cloud Configuration

**Create File**: `.fractary/plugins/faber-cloud/config/faber-cloud.json`

```json
{{faber_cloud_config}}
```

**Configuration Breakdown**:

#### Project Settings
- **Name**: {{project_name}}
- **Repository**: {{repository_url}}

#### Environments Configured
{{#environments_detail}}
- **{{env_name}}**:
  - AWS Profile: `{{aws_profile}}`
  - Region: `{{region}}`
  - Terraform Workspace: `{{workspace}}`
  - Var File: `{{var_file}}`
  - Auto-approve: {{auto_approve}}
{{/environments_detail}}

#### Terraform Settings
- **Directory**: `{{terraform_directory}}`
- **Backend**: {{backend_type}}
- **Structure**: {{terraform_structure}}

#### Hooks Configured

**Pre-Plan Hooks**:
{{#pre_plan_hooks}}
- {{name}}: {{description}}
{{/pre_plan_hooks}}

**Post-Plan Hooks**:
{{#post_plan_hooks}}
- {{name}}: {{description}}
{{/post_plan_hooks}}

**Pre-Deploy Hooks**:
{{#pre_deploy_hooks}}
- {{name}}: {{description}} ({{hook_type}})
{{/pre_deploy_hooks}}

**Post-Deploy Hooks**:
{{#post_deploy_hooks}}
- {{name}}: {{description}} ({{hook_type}})
{{/post_deploy_hooks}}

**Pre-Destroy Hooks**:
{{#pre_destroy_hooks}}
- {{name}}: {{description}} ({{hook_type}})
{{/pre_destroy_hooks}}

**Post-Destroy Hooks**:
{{#post_destroy_hooks}}
- {{name}}: {{description}} ({{hook_type}})
{{/post_destroy_hooks}}

---

### Task 4.2: Validate Configuration

```bash
# Validate the configuration
bash plugins/faber-cloud/skills/infra-adoption/scripts/validate-generated-config.sh \
  .fractary/plugins/faber-cloud/config/faber-cloud.json

# Expected: ✅ Configuration valid
```

---

## Phase 5: Test Integration ({{phase5_hours}} hours)

Test the complete migration before production deployment.

### Task 5.1: Test Individual Skill Hooks

{{#test_skills}}
```bash
# Test {{skill_name}}
export FABER_CLOUD_ENV="test"
export FABER_CLOUD_OPERATION="{{operation}}"
/skill {{skill_name}}

# Expected: {{expected_result}}
```
{{/test_skills}}

{{#has_no_test_skills}}
No skill hooks to test (you didn't create any in Phase 3).
{{/has_no_test_skills}}

---

### Task 5.2: Test Command Delegation

```bash
# Test deploy command delegates to faber-cloud
/deploy --env test

# Expected flow:
# 1. Command reads docs/infrastructure/*.md
# 2. Command invokes @agent-fractary-faber-cloud:infra-manager
# 3. Faber-cloud receives project context
# 4. (Don't proceed with actual deployment yet)
```

---

### Task 5.3: Test Full Deployment to Test Environment

**⚠️ IMPORTANT**: This will actually deploy infrastructure to your test environment.

```bash
# Deploy to test using new workflow
/deploy --env test
```

**Expected Flow**:
1. ✅ Pre-plan hooks execute
   - AWS credential validation
2. ✅ Terraform plan generated
3. ✅ Post-plan hooks execute
4. ✅ Approval (auto-approved for test)
5. ✅ Pre-deploy hooks execute
   {{#pre_deploy_hooks}}
   - {{name}}: {{expected_behavior}}
   {{/pre_deploy_hooks}}
6. ✅ Terraform apply executes
7. ✅ Infrastructure deployed
8. ✅ Post-deploy hooks execute
   {{#post_deploy_hooks}}
   - {{name}}: {{expected_behavior}}
   {{/post_deploy_hooks}}
9. ✅ Deployment complete

**Verification**:
```bash
# Check deployed resources
/fractary-faber-cloud:list --env test

# Verify resources match previous deployment
{{verification_commands}}
```

**Compare with Previous Infrastructure**:
{{comparison_checklist}}

---

### Task 5.4: Test Validation Catches Issues

Intentionally break validation to verify hooks work:

{{#validation_tests}}
#### Test {{test_number}}: {{test_name}}

**Break it**:
```bash
{{break_command}}
```

**Try to deploy**:
```bash
/deploy --env test
```

**Expected**: ❌ {{expected_hook_name}} hook fails, deployment blocked

**Error message should contain**: "{{expected_error_message}}"

**Fix it**:
```bash
{{fix_command}}
```

**Verify fixed**:
```bash
/deploy --env test
```

**Expected**: ✅ Deployment succeeds

---
{{/validation_tests}}

{{#has_no_validation_tests}}
No validation hooks configured - skipping validation tests.
{{/has_no_validation_tests}}

---

## Phase 6: Production Migration ({{phase6_hours}} hours)

Migrate production environment to faber-cloud.

### Task 6.1: Validate Production Configuration

```bash
# Validate prod config
/fractary-faber-cloud:validate --env prod

# Review output for any issues
```

---

### Task 6.2: Review Production Deployment Plan

```bash
# Generate plan (don't apply yet)
/fractary-faber-cloud:deploy-plan --env prod
```

**Review Checklist**:
- [ ] Same resources as current production
- [ ] No unexpected deletions
- [ ] No unexpected creations
- [ ] Resource attributes match current state
- [ ] State file is correct

**Compare with Current Production**:
{{production_comparison}}

---

### Task 6.3: Backup Production State

```bash
# Backup current terraform state
cp {{terraform_directory}}/terraform.tfstate \
   {{terraform_directory}}/terraform.tfstate.pre-faber-cloud-{{date}}

# Backup to S3 (if using remote backend)
{{backup_remote_state_command}}
```

---

### Task 6.4: Deploy to Production

**⚠️ PRODUCTION DEPLOYMENT**

**Pre-deployment checklist**:
- [ ] Test environment validated successfully
- [ ] Production plan reviewed and approved
- [ ] Terraform state backed up
- [ ] Team notified of deployment
- [ ] Rollback plan ready
{{production_checklist}}

**Deploy**:
```bash
# Deploy to production
/deploy --env prod
```

**Expected Flow**:
1. ✅ Pre-plan hooks execute
2. ✅ Terraform plan generated
3. ⏸️ **Manual approval required**
4. ✅ Pre-deploy hooks execute ({{pre_deploy_prod_hooks}})
5. ✅ Terraform apply executes
6. ✅ Post-deploy hooks execute ({{post_deploy_prod_hooks}})
7. ✅ Deployment verified
8. ✅ Resources documented

**Post-Deployment Verification**:
```bash
# Verify deployed resources
/fractary-faber-cloud:list --env prod

# Run smoke tests
{{smoke_test_commands}}

# Check application functionality
{{app_functionality_checks}}

# Monitor for 24 hours
{{monitoring_commands}}
```

---

## Phase 7: Finalization ({{phase7_hours}} hours)

Complete the migration and clean up.

### Task 7.1: Archive Old Scripts/Commands

```bash
# Create archive directory
mkdir -p .claude/commands/.archive
mkdir -p scripts/.archive

# Archive old commands (keep as backup)
{{#archived_commands}}
mv {{old_path}} .claude/commands/.archive/
{{/archived_commands}}

# Archive old scripts (keep as backup)
{{#archived_scripts}}
cp {{script_path}} scripts/.archive/
{{/archived_scripts}}

# Don't delete yet - keep for reference
```

---

### Task 7.2: Update Project README

Add to `README.md`:

```markdown
{{readme_addition}}
```

---

### Task 7.3: Document Rollback Procedure

**Create File**: `docs/infrastructure/ROLLBACK.md`

```markdown
{{rollback_content}}
```

---

### Task 7.4: Train Team

- [ ] Share this adoption spec with team
- [ ] Demo new `/deploy` workflow
- [ ] Show how to view deployed resources
- [ ] Explain hook system
- [ ] Document emergency procedures
- [ ] Update runbooks

---

## Risk Assessment

{{#risks}}
### {{risk_level}}: {{risk_title}}

**Description**: {{risk_description}}

**Impact**: {{risk_impact}}

**Mitigation**: {{risk_mitigation}}

**Probability**: {{risk_probability}}

---
{{/risks}}

## Rollback Plan

### If Migration Fails

1. **Stop**: Don't proceed with deployment
2. **Assess**: Review error logs and identify issue
3. **Options**:
   - Fix issue and retry
   - Rollback to old process (see below)

### If Production Deployment Has Issues

1. **Immediate Actions**:
   ```bash
   # Restore previous terraform state
   cp {{terraform_directory}}/terraform.tfstate.pre-faber-cloud-{{date}} \
      {{terraform_directory}}/terraform.tfstate

   # Review what changed
   terraform plan -var-file=prod.tfvars

   # Rollback if needed
   terraform apply -var-file=prod.tfvars
   ```

2. **Revert Configuration**:
   ```bash
   # Disable faber-cloud config
   mv .fractary/plugins/faber-cloud/config/faber-cloud.json \
      .fractary/plugins/faber-cloud/config/faber-cloud.json.disabled

   # Restore old commands
   cp .claude/commands/.archive/deploy.md .claude/commands/
   ```

3. **Use Original Process**: Continue with old deployment process until issues resolved

---

## Success Criteria

Migration is successful when:

- [ ] `/deploy --env test` successfully deploys infrastructure
- [ ] Deployed resources match previous infrastructure exactly
- [ ] All validation hooks execute correctly
- [ ] Hooks catch intentionally broken configurations
- [ ] `/deploy --env prod` successfully deploys to production
- [ ] Production infrastructure matches previous state
- [ ] No resource deletions or unexpected changes
- [ ] Team can successfully use new workflow
- [ ] Documentation is complete and accurate
- [ ] Rollback procedure is tested and documented

---

## Timeline Summary

| Phase | Description | Time | Status |
|-------|-------------|------|--------|
| 1 | Project Documentation | {{phase1_hours}}h | ⏳ Pending |
| 2 | Convert Commands | {{phase2_hours}}h | ⏳ Pending |
| 3 | Create Skill Hooks | {{phase3_hours}}h | ⏳ Pending |
| 4 | Configure Faber-Cloud | {{phase4_hours}}h | ⏳ Pending |
| 5 | Test Integration | {{phase5_hours}}h | ⏳ Pending |
| 6 | Production Migration | {{phase6_hours}}h | ⏳ Pending |
| 7 | Finalization | {{phase7_hours}}h | ⏳ Pending |
| **Total** | | **{{estimated_hours}}h** | |

---

## Appendix

### Appendix A: Discovered Infrastructure Summary

```json
{{discovery_terraform_summary}}
```

### Appendix B: Discovered AWS Configuration

```json
{{discovery_aws_summary}}
```

### Appendix C: Discovered Custom Scripts

```json
{{discovery_custom_agents_summary}}
```

### Appendix D: Full Configuration Files

#### faber-cloud.json (Full)
```json
{{full_faber_cloud_config}}
```

---

## Support

If issues arise during migration:

1. **Review logs**: Check faber-cloud execution logs
2. **Test hooks individually**: Isolate failing skill hooks
3. **Verify configuration**: Check faber-cloud.json is correct
4. **Check documentation**: Ensure docs passed to faber-cloud are accurate
5. **Rollback if needed**: Use rollback procedure above

---

**End of Adoption Spec**

*Generated by faber-cloud infrastructure adoption workflow*
*This spec provides complete, step-by-step migration guidance with all code and configuration ready to use*
