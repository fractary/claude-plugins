# Specification Format Guide

This guide describes the format and conventions for specifications generated by the fractary-spec plugin.

## Frontmatter

All specs must include YAML frontmatter:

```yaml
---
spec_id: spec-123-user-auth          # Unique identifier
issue_number: 123                     # GitHub issue number
issue_url: https://github.com/.../123 # Link to issue
title: Implement user authentication  # Spec title
type: feature                         # Work type: feature|bug|infrastructure|api
status: draft                         # Status: draft|in_progress|validated|archived
created: 2025-01-15                   # Creation date
author: username                      # Author/assignee
validated: false                      # Validation status
---
```

## Naming Conventions

### Single Spec
```
spec-{issue_number}-{slug}.md
```
Example: `spec-123-user-authentication.md`

### Multi-Spec (Phases)
```
spec-{issue_number}-phase{phase}-{slug}.md
```
Examples:
- `spec-123-phase1-user-auth.md`
- `spec-123-phase2-oauth-integration.md`

### Slug Generation
- Take first 4-5 words of title
- Convert to lowercase
- Replace spaces with hyphens
- Remove special characters
- Examples:
  - "Implement User Authentication System" → "user-authentication-system"
  - "Fix Critical Bug in Auth" → "fix-critical-bug-auth"

## Template Types

### spec-basic.md.template
General-purpose template for any work type.

**Use for**:
- Simple tasks
- Documentation updates
- Minor changes
- Uncategorized work

**Key sections**:
- Summary
- Requirements (functional & non-functional)
- Technical Approach
- Files to Modify
- Acceptance Criteria
- Testing Strategy

### spec-feature.md.template
Comprehensive template for new features.

**Use for**:
- New user-facing features
- Enhancements
- User stories
- Major functionality additions

**Key sections**:
- User Stories
- Functional/Non-Functional Requirements
- Technical Design (Architecture, Data Model, API, UI/UX)
- Implementation Plan (Phases)
- Testing Strategy (Unit, Integration, E2E, Performance)
- Rollout Plan
- Success Metrics

### spec-infrastructure.md.template
Template for infrastructure and DevOps work.

**Use for**:
- Cloud infrastructure
- Deployments
- CI/CD changes
- Resource provisioning
- Configuration management

**Key sections**:
- Current vs Target State
- Architecture (Components, Network, Data Flow)
- Resources Required (Compute, Storage, Network)
- Configuration (Env vars, Secrets, Config files)
- Deployment Strategy (IaC, Steps, Rollback)
- Monitoring & Observability
- Security Considerations
- Cost Estimation

### spec-api.md.template
Template for API development.

**Use for**:
- REST/GraphQL APIs
- New endpoints
- API changes
- Integration points

**Key sections**:
- API Overview (Base URL, Version, Auth)
- Endpoints (Method, Path, Request/Response)
- Data Models (Schema, Validation)
- Authentication & Authorization
- Error Handling
- Rate Limiting
- Pagination
- OpenAPI/Swagger Spec

### spec-bug.md.template
Template for bug fixes.

**Use for**:
- Bug fixes
- Defects
- Hotfixes
- Regression issues

**Key sections**:
- Bug Description (Observed vs Expected)
- Impact (Severity, Affected Users, Features)
- Reproduction Steps
- Root Cause Analysis
- Proposed Fix (Solution, Code Changes, Why It Works)
- Alternative Solutions
- Risk Assessment
- Prevention Measures

## Work Type Classification

### Auto-Detection Rules

**Bug**:
- Labels: "bug", "defect", "hotfix"
- Title patterns: "Fix", "Bug:", "Hotfix:"

**Feature**:
- Labels: "feature", "enhancement", "story"
- Title patterns: "Add", "Feature:", "Implement"

**Infrastructure**:
- Labels: "infrastructure", "devops", "cloud", "deployment"
- Title contains: "infrastructure", "deploy", "AWS", "Docker", "Kubernetes"

**API**:
- Labels: "api", "endpoint", "rest", "graphql"
- Title contains: "API", "endpoint", "/api/"

**Default**: basic (if no matches)

## Parsing Issue Body

### Acceptance Criteria
Look for section:
```markdown
## Acceptance Criteria
- [ ] Criterion 1
- [ ] Criterion 2
```

Extract checklist items.

### Requirements
Look for sections:
```markdown
## Requirements
- Requirement 1
- Requirement 2

## Functional Requirements
- FR1: Description

## Non-Functional Requirements
- NFR1: Description
```

Extract and categorize.

### Files
Look for:
```markdown
## Files
- `path/to/file.ts`: Description
```

### Dependencies
Look for:
```markdown
## Dependencies
- Package X
- Service Y
```

## Best Practices

### Writing Good Specs

1. **Be Specific**: Clearly define what needs to be done
2. **Be Testable**: Include measurable acceptance criteria
3. **Be Complete**: Cover all aspects (functional, technical, testing)
4. **Be Realistic**: Set achievable goals and timelines
5. **Be Clear**: Use simple language, avoid ambiguity

### Acceptance Criteria

Use checkboxes:
```markdown
- [ ] User can register with email
- [ ] Password meets complexity requirements
- [ ] Confirmation email sent
- [ ] User redirected to dashboard
```

### Technical Approach

Describe:
- High-level architecture
- Key components
- Data flow
- External dependencies
- Technologies used

### Files to Modify

List expected changes:
```markdown
- `src/auth/register.ts`: Add registration logic
- `src/models/user.ts`: Add User model
- `src/routes/auth.ts`: Add registration endpoint
- `tests/auth.test.ts`: Add registration tests
```

### Testing Strategy

Define:
- Unit tests needed
- Integration tests needed
- E2E tests needed
- Manual testing checklist

## Multi-Spec Support

For large issues, create multiple specs:

```markdown
Issue #123: Implement Complete Auth System

Specs:
- spec-123-phase1-user-registration.md
- spec-123-phase2-login-logout.md
- spec-123-phase3-password-reset.md
- spec-123-phase4-oauth-integration.md
```

Each spec should:
- Be self-contained
- Have clear scope
- Reference other phases if dependent
- Have own acceptance criteria

## Validation

Specs are validated before archival:
- Requirements coverage
- Acceptance criteria met
- Expected files modified
- Tests added
- Documentation updated

## Archival

After work completes:
- Specs uploaded to cloud storage
- Archive index updated
- GitHub issue/PR commented
- Local specs removed

Archived specs remain accessible via:
```bash
/fractary-spec:read 123
```

## Example Spec

See templates directory for complete examples:
- `templates/spec-basic.md.template`
- `templates/spec-feature.md.template`
- `templates/spec-infrastructure.md.template`
- `templates/spec-api.md.template`
- `templates/spec-bug.md.template`
