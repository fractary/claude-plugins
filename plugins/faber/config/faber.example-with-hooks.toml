# FABER Configuration with Hooks Example
# This demonstrates the unified hook and context injection system

[project]
name = "my-application"
issue_system = "github"
source_control = "github"
preset = "software-guarded"

[workflow]
max_evaluate_retries = 3
auto_merge = false

[workflow.skills]
frame = "basic"
architect = "basic"
build = "basic"
evaluate = "basic"
release = "basic"

# ============================================================================
# HOOKS CONFIGURATION
# ============================================================================
# Hooks enable project-specific customization without requiring wrapper commands
# Four hook types: script, skill, context, prompt
# Hook timing: pre (before phase) and post (after phase)

# ────────────────────────────────────────────────────────────────────────────
# FRAME PHASE HOOKS
# ────────────────────────────────────────────────────────────────────────────

[[hooks.frame.pre]]
type = "context"
name = "work-classification"
prompt = "Use the project's work classification system when categorizing issues."
references = [
  { path = "docs/process/WORK_CLASSIFICATION.md", description = "Work classification rules" }
]
weight = "medium"

[[hooks.frame.post]]
type = "script"
path = "./scripts/setup-dev-environment.sh"
name = "setup-dev-env"
description = "Setup development environment and dependencies"
required = true
failureMode = "stop"
timeout = 300

# ────────────────────────────────────────────────────────────────────────────
# ARCHITECT PHASE HOOKS
# ────────────────────────────────────────────────────────────────────────────

[[hooks.architect.pre]]
type = "context"
name = "architecture-standards"
prompt = """
Follow the architectural patterns, design principles, and API standards
documented in our architecture guide when designing solutions.
"""
references = [
  {
    path = "docs/architecture/DESIGN_STANDARDS.md",
    description = "Core design standards",
    sections = ["Microservices Patterns", "Database Design", "Caching Strategy"]
  },
  {
    path = "docs/architecture/API_DESIGN.md",
    description = "API design guide",
    sections = ["REST Conventions", "Versioning", "Error Handling", "Authentication"]
  }
]
weight = "high"

[[hooks.architect.pre]]
type = "prompt"
name = "technology-constraints"
content = """
Technology Stack Constraints:
- Backend: Node.js (TypeScript) with Express
- Database: PostgreSQL 15+ with Prisma ORM
- Cache: Redis for session and data caching
- API: REST with OpenAPI 3.0 specs
- Auth: JWT tokens with refresh token rotation
"""
weight = "high"

[[hooks.architect.post]]
type = "skill"
name = "architecture-reviewer"
description = "Review architecture spec against project standards"
required = false
failureMode = "warn"
timeout = 300

# ────────────────────────────────────────────────────────────────────────────
# BUILD PHASE HOOKS
# ────────────────────────────────────────────────────────────────────────────

[[hooks.build.pre]]
type = "context"
name = "coding-standards"
prompt = """
Follow the project's coding standards, testing requirements, and
code organization patterns when implementing changes.
"""
references = [
  { path = "docs/development/CODING_STANDARDS.md", description = "Coding standards" },
  { path = "docs/development/TESTING_GUIDE.md", description = "Testing patterns and requirements" },
  { path = "docs/development/CODE_ORGANIZATION.md", description = "Code organization patterns" }
]
weight = "high"

[[hooks.build.pre]]
type = "script"
path = "./scripts/pre-build-checks.sh"
name = "pre-build-checks"
description = "Run pre-build validation checks"
required = true
failureMode = "stop"
timeout = 120

[[hooks.build.post]]
type = "script"
path = "./scripts/build-project.sh"
name = "build-project"
description = "Build the project and generate artifacts"
required = true
failureMode = "stop"
timeout = 600

[[hooks.build.post]]
type = "skill"
name = "code-quality-checker"
description = "Run code quality checks (linting, formatting, complexity)"
required = true
failureMode = "stop"
timeout = 300

[[hooks.build.post]]
type = "skill"
name = "security-scanner"
description = "Run security scanning on code and dependencies"
required = true
failureMode = "stop"
timeout = 600

# ────────────────────────────────────────────────────────────────────────────
# EVALUATE PHASE HOOKS
# ────────────────────────────────────────────────────────────────────────────

[[hooks.evaluate.pre]]
type = "context"
name = "testing-requirements"
prompt = """
Ensure all changes meet the project's testing requirements including
unit tests, integration tests, and test coverage thresholds.
"""
references = [
  {
    path = "docs/development/TESTING_GUIDE.md",
    description = "Testing standards and requirements",
    sections = ["Coverage Requirements", "Test Patterns", "Integration Testing"]
  }
]
weight = "high"

[[hooks.evaluate.pre]]
type = "prompt"
name = "quality-gates"
content = """
Quality Gate Requirements:
- Unit test coverage: minimum 80%
- Integration test coverage: minimum 60%
- All tests must pass
- No critical or high security vulnerabilities
- Linting must pass with no errors
- Build must succeed
"""
weight = "critical"

[[hooks.evaluate.post]]
type = "skill"
name = "test-coverage-validator"
description = "Validate test coverage meets project requirements"
required = true
failureMode = "stop"
timeout = 300

# ────────────────────────────────────────────────────────────────────────────
# RELEASE PHASE HOOKS
# ────────────────────────────────────────────────────────────────────────────

[[hooks.release.pre]]
type = "context"
name = "release-standards"
prompt = "Follow the project's release checklist and documentation requirements."
references = [
  { path = "docs/process/RELEASE_CHECKLIST.md", description = "Release checklist" },
  { path = ".github/CHANGELOG_TEMPLATE.md", description = "Changelog format" },
  { path = "docs/process/PR_TEMPLATE.md", description = "Pull request template" }
]
weight = "high"

[[hooks.release.pre]]
type = "prompt"
name = "release-checklist"
content = """
Release Checklist:
✓ All tests pass
✓ Code review completed
✓ Documentation updated
✓ Changelog entry added
✓ Database migrations reviewed (if applicable)
✓ API changes documented (if applicable)
✓ Monitoring/alerting configured (if applicable)
"""
weight = "critical"

# Environment-specific hooks (only for production)
[[hooks.release.pre]]
type = "prompt"
name = "production-warning"
content = """
⚠️  PRODUCTION RELEASE ⚠️

This release will deploy to PRODUCTION. Extra precautions:

1. Verify all changes are backward compatible
2. Confirm database migrations are reversible
3. Ensure feature flags are configured
4. Document rollback procedure
5. Notify team in #deployments channel
6. Schedule during maintenance window if breaking

Proceed only after confirming all items above.
"""
weight = "critical"
environments = ["prod", "production"]

[[hooks.release.post]]
type = "script"
path = "./scripts/post-release-validation.sh"
name = "post-release-validation"
description = "Validate release was successful"
required = false
failureMode = "warn"
timeout = 300

[[hooks.release.post]]
type = "skill"
name = "release-documenter"
description = "Update release documentation and notify team"
required = false
failureMode = "warn"
timeout = 300

# ============================================================================
# DOMAIN-SPECIFIC CONFIGURATION
# ============================================================================

[workflow.architect]
generate_spec = true
spec_template = "auto"

[workflow.build]
capture_build_logs = true

[workflow.evaluate]
validate_spec = true
parallel_testing = false

[workflow.release]
update_documentation = "prompt"
archive_specs = true
cleanup_branch = false

# ============================================================================
# ENVIRONMENT-SPECIFIC SETTINGS
# ============================================================================

[environments.dev]
auto_merge = false
skip_manual_approval = true

[environments.test]
auto_merge = false
skip_manual_approval = true

[environments.staging]
auto_merge = false
skip_manual_approval = false

[environments.prod]
auto_merge = false
skip_manual_approval = false
require_approval = true
